<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>單字卡學習程式</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', 'Inter', sans-serif;
            touch-action: manipulation; /* 禁用雙擊縮放 */
        }
        .card {
            /* 字體大小現在由 JavaScript 控制 */
            line-height: 1.2;
            overflow-wrap: break-word;
            word-break: break-word;
        }
        .card .placeholder { display: block; }
        .card .content { display: none; }
        .card.revealed .placeholder { display: none; }
        .card.revealed .content { display: block; }
        button, .card, #main-screen {
            -webkit-tap-highlight-color: transparent;
        }
        #menu-panel {
            transition: transform 0.3s ease-in-out;
        }
        #menu-panel.closed { transform: translateX(-100%); }
        #menu-panel.open { transform: translateX(0); }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 flex items-center justify-center min-h-screen p-2 sm:p-4">

    <div id="app" class="w-full max-w-6xl mx-auto">

        <!-- 上傳畫面 -->
        <div id="upload-screen" class="text-center p-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg">
            <h1 class="text-3xl font-bold mb-4 text-gray-900 dark:text-white">單字卡學習程式</h1>
            <p class="mb-6 text-gray-600 dark:text-gray-300">請上傳您的 .txt 單字檔。<br>檔案內容應以分號 (;) 分隔，每一行代表一組卡片。</p>
            <div class="flex items-center justify-center w-full">
                <label for="file-upload" class="flex flex-col items-center justify-center w-full h-48 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-bray-800 dark:bg-gray-700 hover:bg-gray-100 dark:hover:border-gray-500 dark:hover:bg-gray-600 transition-colors">
                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                        <svg class="w-10 h-10 mb-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/></svg>
                        <p class="mb-2 text-sm text-gray-500 dark:text-gray-400"><span class="font-semibold">點擊此處上傳</span> 或拖曳檔案至此</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">僅限 .txt 檔案</p>
                    </div>
                    <input id="file-upload" type="file" class="hidden" accept=".txt">
                </label>
            </div>
             <div class="mt-4 text-gray-500 dark:text-gray-400">或</div>
            <div class="mt-4 flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                <select id="example-selector" class="block w-full px-4 py-3 text-base border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-600 focus:outline-none focus:ring-teal-500 focus:border-teal-500 rounded-lg">
                    <option value="" disabled selected>--- 選擇一個內建範例 ---</option>
                    <option value="verbs">範例一：動詞三態</option>
                    <option value="meanings">範例二：字義篇整理</option>
                </select>
                <button id="load-selected-example-btn" class="px-6 py-3 bg-teal-500 text-white font-semibold rounded-lg shadow-md hover:bg-teal-600 transition-colors whitespace-nowrap">載入範例</button>
            </div>
            <div id="error-message" class="mt-4 text-red-500 font-semibold"></div>
        </div>

        <!-- 主學習畫面 -->
        <div id="main-screen" class="hidden w-full h-[95vh] flex flex-col bg-gray-200 dark:bg-gray-800 rounded-2xl shadow-lg p-2 relative overflow-hidden">
            <div id="card-area" class="flex-grow flex items-center justify-center w-full h-full">
                <div id="card-container" class="grid gap-2 w-full h-full">
                    <!-- 卡片將會動態生成於此 -->
                </div>
            </div>
            <!-- 控制按鈕區 -->
            <div class="absolute bottom-4 left-4 right-4 flex justify-between items-center space-x-2">
                <button id="prev-btn" class="px-4 py-3 bg-gray-300 dark:bg-gray-600 rounded-full shadow-md hover:bg-gray-400 dark:hover:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all transform hover:scale-105"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg></button>
                <div class="flex space-x-4">
                    <button id="incorrect-btn" class="w-16 h-16 sm:w-20 sm:h-20 flex items-center justify-center text-4xl bg-red-500 text-white rounded-full shadow-lg hover:bg-red-600 transition-all transform hover:scale-110">❌</button>
                    <button id="correct-btn" class="w-16 h-16 sm:w-20 sm:h-20 flex items-center justify-center text-4xl bg-green-500 text-white rounded-full shadow-lg hover:bg-green-600 transition-all transform hover:scale-110">✅</button>
                </div>
                <button id="next-btn" class="px-4 py-3 bg-gray-300 dark:bg-gray-600 rounded-full shadow-md hover:bg-gray-400 dark:hover:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all transform hover:scale-105"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg></button>
            </div>
            <!-- 頂部 UI -->
            <div class="absolute top-4 left-4 right-4 flex justify-between items-center">
                <button id="menu-btn" class="p-2 bg-gray-300 dark:bg-gray-700 rounded-full shadow-md hover:bg-gray-400 dark:hover:bg-gray-600 transition-colors z-30"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg></button>
                <div id="deck-info" class="text-sm font-medium bg-gray-300 dark:bg-gray-700 px-3 py-1 rounded-full"></div>
            </div>
            <div id="history-alert" class="hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-yellow-500 text-white px-6 py-3 rounded-lg shadow-xl text-center z-40"><p>無法再返回！</p><p class="text-sm">（最多保留20組歷史紀錄）</p></div>

            <!-- 選單面板 -->
            <div id="menu-overlay" class="hidden absolute inset-0 bg-black bg-opacity-50 z-10"></div>
            <div id="menu-panel" class="closed absolute top-0 left-0 h-full w-72 bg-white dark:bg-gray-800 shadow-lg z-20 p-4 flex flex-col">
                <div class="flex justify-between items-center mb-6"><h2 class="text-xl font-bold">選單</h2><button id="close-menu-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div>
                
                <div class="flex-grow">
                    <ul class="space-y-2">
                        <li><button id="show-all-btn" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">📄 顯示所有卡片</button></li>
                        <li><button id="toggle-layout-btn" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">🔃 切換排列方向</button></li>
                        <li><button id="toggle-auto-reveal-btn" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">▶️ 自動翻開首張：<span class="font-bold text-red-500">關</span></button></li>
                        <!-- 字型大小調整 -->
                        <li class="w-full text-left px-4 py-2 flex items-center justify-between text-gray-800 dark:text-gray-200">
                            <span class="mr-2">🅰️ 大小</span>
                            <div class="flex items-center space-x-2">
                                <button id="font-size-decrease" class="px-3 py-1 bg-gray-200 dark:bg-gray-600 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 font-bold">-</button>
                                <span id="font-size-value" class="w-16 text-center text-sm">預設</span>
                                <button id="font-size-increase" class="px-3 py-1 bg-gray-200 dark:bg-gray-600 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 font-bold">+</button>
                            </div>
                        </li>
                        <li><button id="how-to-use-btn" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">❔ 使用教學</button></li>
                    </ul>
                </div>
                
                <div class="mt-auto border-t pt-2 border-gray-200 dark:border-gray-700">
                     <ul class="space-y-2">
                        <li><button id="open-new-btn" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">📂 開啟新檔/範例</button></li>
                        <li><button id="download-btn" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">💾 下載學習紀錄</button></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- 所有卡片列表 Modal -->
    <div id="all-cards-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-30"><div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-4xl h-[90vh] flex flex-col"><div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"><h2 class="text-xl font-bold">所有卡片</h2><button id="close-modal-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div><div class="flex-grow overflow-y-auto p-4"><table id="all-cards-table" class="w-full text-left"></table></div></div></div>
    
    <!-- 下載格式選擇 Modal -->
    <div id="download-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-40">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-sm">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"><h2 class="text-xl font-bold">選擇下載格式</h2><button id="close-download-modal-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div>
            <div class="p-4 grid grid-cols-2 gap-4">
                <button data-format="csv" class="download-format-btn px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">CSV</button>
                <button data-format="txt" class="download-format-btn px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">TXT</button>
            </div>
        </div>
    </div>

    <!-- 使用教學 Modal -->
    <div id="how-to-use-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-30">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-2xl h-auto max-h-[90vh] flex flex-col">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h2 class="text-xl font-bold">使用教學</h2>
                <button id="close-how-to-use-modal-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <!-- 您可以在此處修改教學內容 -->
            <div class="flex-grow overflow-y-auto p-6 space-y-4 text-gray-700 dark:text-gray-300">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">程式總覽</h3>
                <p>這是一份針對你提供的「單字卡學習程式」的詳細使用教學。這款程式能讓你上傳自製的單字檔案，並透過單字卡模式來進行學習與測驗。</p>
                <ul class="list-disc list-inside space-y-2">
                    <li><strong>上傳畫面：</strong>用來載入你的單字檔案，或選擇內建的範例。</li>
                    <li><strong>主學習畫面：</strong>單字卡學習和操作的主要介面。</li>
                </ul>

                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">一、檔案準備與卡片載入</h3>
                <ul class="list-disc list-inside space-y-2">
                    <li><strong>📝 檔案格式</strong>
                        <ul class="list-circle list-inside ml-4">
                            <li>你需要一個 <strong>.txt</strong> 文字檔，並遵循以下格式：
                                <ul class="list-square list-inside ml-4">
                                    <li>每組單字卡佔用一行。</li>
                                    <li>卡片上的每個內容（欄位）之間以 <strong>分號 (;)</strong> 分隔。</li>
                                    <li>例如：<code>單字;發音;解釋</code> 或 <code>中文;英文</code>。</li>
                                    <li>你可以在任何欄位中使用 <strong>雙斜線 (//)</strong> 來換行，例如：<code>動詞;to learn//learned//learned</code>。</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><strong>📁 載入方式</strong>
                        <ul class="list-circle list-inside ml-4">
                            <li><strong>上傳檔案：</strong>點擊「點擊此處上傳」區域，或將你的 <strong>.txt</strong> 檔拖曳到該區域。</li>
                            <li><strong>載入範例：</strong>若沒有檔案，你可以從下拉選單中選擇內建的範例，然後點擊「載入範例」。</li>
                        </ul>
                    </li>
                </ul>

                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">二、主學習畫面操作</h3>
                <p>成功載入檔案後，程式會切換到主學習畫面，讓你開始學習。</p>
                <ul class="list-disc list-inside space-y-2">
                    <li><strong>🃏 單字卡操作</strong>
                        <ul class="list-circle list-inside ml-4">
                            <li><strong>翻開卡片：</strong>點擊卡片，卡片上的內容會從「問號」變成答案。</li>
                            <li><strong>下一張：</strong>在畫面任一處點擊（除了卡片本身和按鈕），會自動跳到下一張卡片。</li>
                        </ul>
                    </li>
                    <li><strong>答對／答錯</strong>
                        <ul class="list-circle list-inside ml-4">
                            <li>點擊右下角的 <strong>✅</strong>，表示你答對了這張卡片。答對的卡片會從待學習列表中移除，直到你學完所有卡片為止。</li>
                            <li>點擊左下角的 <strong>❌</strong>，表示你答錯了。答錯的卡片會繼續留在待學習列表，下次還有機會再次抽到。</li>
                        </ul>
                    </li>
                    <li><strong>🔄 導航與紀錄</strong>
                        <ul class="list-circle list-inside ml-4">
                            <li><strong>回到上一張：</strong>點擊左下角的 <strong>《</strong> 按鈕，可以返回上一張卡片。</li>
                            <li><strong>跳到下一張：</strong>點擊右下角的 <strong>》</strong> 按鈕，可以不評分直接跳到下一張卡片。</li>
                            <li><strong>歷史紀錄：</strong>程式最多會保留 <strong>20 組</strong> 卡片歷史紀錄，方便你隨時回顧。</li>
                        </ul>
                    </li>
                </ul>

                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">三、選單功能</h3>
                <p>點擊左上角的 <strong>☰</strong> 圖示，會彈出功能選單。</p>
                <ul class="list-disc list-inside space-y-2">
                    <li><strong>📄 顯示所有卡片：</strong>開啟一個新視窗，顯示所有卡片及其學習狀態（✅ 答對、❌ 答錯、⬜ 未學習）。</li>
                    <li><strong>🔃 切換排列方向：</strong>切換多欄位卡片的排列方式，可以在 <strong>水平</strong> 和 <strong>垂直</strong> 之間切換。</li>
                    <li><strong>▶️ 自動翻開首張：</strong>開啟或關閉這個選項。當開啟時，每次載入新卡片，第一個欄位會自動翻開。</li>
                    <li><strong>🅰️ 大小：</strong>調整<strong>卡片上</strong>顯示的字型大小。</li>
                    <li><strong>❔ 使用教學：</strong>開啟此份使用教學</li>

                    <li><strong>📂 開啟新檔/範例：</strong>回到上傳畫面，讓你可以載入新的檔案或範例。</li>
                    <li><strong>💾 下載學習紀錄：</strong>根據當前的學習狀態，下載所有卡片的列表。你可以選擇 <strong>.CSV</strong> 或 <strong>.TXT</strong> 兩種格式。</li>
                </ul>
                <p>希望這份教學能幫助你順利使用這個單字卡程式！祝你學習愉快！</p>

                <!-- 隱藏 -->
                <br>
                <div class="text-gray-400 dark:text-gray-600">
                    <p>v2.8.1 2025-08-30</p>
                </div>
            </div>
            <!-- 教學內容結束 -->
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM 元素
            const uploadScreen = document.getElementById('upload-screen');
            const mainScreen = document.getElementById('main-screen');
            const fileUpload = document.getElementById('file-upload');
            const exampleSelector = document.getElementById('example-selector');
            const loadSelectedExampleBtn = document.getElementById('load-selected-example-btn');
            const errorMessage = document.getElementById('error-message');
            const cardContainer = document.getElementById('card-container');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const correctBtn = document.getElementById('correct-btn');
            const incorrectBtn = document.getElementById('incorrect-btn');
            const deckInfo = document.getElementById('deck-info');
            const historyAlert = document.getElementById('history-alert');
            const menuBtn = document.getElementById('menu-btn');
            const closeMenuBtn = document.getElementById('close-menu-btn');
            const menuPanel = document.getElementById('menu-panel');
            const menuOverlay = document.getElementById('menu-overlay');
            const showAllBtn = document.getElementById('show-all-btn');
            const openNewBtn = document.getElementById('open-new-btn');
            const downloadBtn = document.getElementById('download-btn');
            const toggleLayoutBtn = document.getElementById('toggle-layout-btn');
            const toggleAutoRevealBtn = document.getElementById('toggle-auto-reveal-btn');
            const allCardsModal = document.getElementById('all-cards-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const allCardsTable = document.getElementById('all-cards-table');
            const downloadModal = document.getElementById('download-modal');
            const closeDownloadModalBtn = document.getElementById('close-download-modal-btn');
            // 新增：教學與字體大小相關元素
            const howToUseBtn = document.getElementById('how-to-use-btn');
            const howToUseModal = document.getElementById('how-to-use-modal');
            const closeHowToUseModalBtn = document.getElementById('close-how-to-use-modal-btn');
            const fontSizeDecrease = document.getElementById('font-size-decrease');
            const fontSizeIncrease = document.getElementById('font-size-increase');
            const fontSizeValue = document.getElementById('font-size-value');


            // 應用程式狀態
            let fieldsPerCard = 0;
            let fullDeck = [];
            let learningDeck = [];
            let cardStatus = new Map();
            let history = [];
            let historyIndex = -1;
            const MAX_HISTORY = 20;
            let cardLayout = 'horizontal'; // 'horizontal' or 'vertical'
            let autoRevealFirstCard = false;
            // 新增：字體大小狀態
            let cardFontSize = 2.5; // 單位為 rem
            const DEFAULT_FONT_SIZE = 2.5;
            const FONT_SIZE_STEP = 0.2;
            const MIN_FONT_SIZE = 1.0;
            const MAX_FONT_SIZE = 5.0;

            // --- 內建範例檔案 ---
            const EXAMPLES = {
                'verbs': `拜訪;visit-visited-visited
觀看;watch-watched-watched
玩;play-played-played
洗、演奏;wash-washed-washed
喜歡;like-liked-liked
愛;love-loved-loved
恨;hate-hated-hated
停止;stop-stopped-stopped
計畫;plan-planned-planned
哭泣;cry-cried-cried
嘗試;try-tried-tried
研讀;study-studied-studied
價值、花費;cost-cost-cost
切、割;cut-cut-cut
撞、打;hit-hit-hit
傷害;hurt-hurt-hurt
讓;let-let-let
放置、樹立;put-put-put
設置;set-set-set
閱讀;read-read-read
打賭;bet-bet-bet
適合、合身;fit-fit-fit
停止、放棄;quit-quit-quit
來;come-came-come
變成;become-became-become
跑步;run-ran-run
帶來;bring-brought-brought
買;buy-bought-bought
想、認為;think-thought-thought
打架、爭吵;fight-fought-fought
抓、接、染上;catch-caught-caught
教書;teach-taught-taught
覺得;feel-felt-felt
保持;keep-kept-kept
睡覺;sleep-slept-slept
哭泣;weep-wept-wept
離開;leave-left-left
建造;build-built-built
借出;lend-lent-lent
寄送;send-sent-sent
（人）花費;spend-spent-spent
有;have-had-had
做;make-made-made
輸掉;lose-lost-lost
聽見;hear-heard-heard
意指;mean-meant-meant
付錢;pay-paid-paid
說（的話）;say-said-said
餵;feed-fed-fed
領導;lead-led-led
遇見;meet-met-met
挖;dig-dug-dug
搖擺;swing-swung-swung
懸吊;hang-hung-hung
發現;find-found-found
得到;get-got-gotten
忘記;forget-forgot-forgotten
握住、舉辦;hold-held-held
坐;sit-sat-sat
賣出;sell-sold-sold
告訴;tell-told-told
贏;win-won-won
站、起立;stand-stood-stood
了解;understand-understood-understood
躺;lie-lay-lain
說謊;lie-lied-lied
開始;begin-began-begun
喝;drink-drank-drunk
按鈴;ring-rang-rung
唱歌;sing-sang-sung
游泳;swim-swam-swum
打破;break-broke-broken
說、講話;speak-spoke-spoken
偷;steal-stole-stolen
醒來;wake-woke-woken
出生;bear-bore-born
穿、戴;wear-wore-worn
做;do-did-done
去;go-went-gone
咬;bite-bit-bitten
躲藏;hide-hid-hidden
騎;ride-rode-ridden
寫;write-wrote-written
是;be-was-were-been
跌倒、掉落;fall-fell-fallen
吃;eat-ate-eaten
選擇;choose-chose-chosen
開車;drive-drove-driven
給;give-gave-given
搖動、震動;shake-shook-shaken
拿走、搭乘;take-took-taken
看到;see-saw-seen
畫圖;draw-drew-drawn
吹、爆炸;blow-blew-blown
種、成長;grow-grew-grown
知道、認識;know-knew-known
丟;throw-threw-thrown
飛;fly-flew-flown
結凍;freeze-froze-frozen
原諒;forgive-forgave-forgiven`,
                'meanings': `譬如為山，未成一簣 ，「止」，吾「止」也;停止
去後「乃」至;才
「乃」放老馬而隨之;於是
自知「乃」是知識的基石;是
廷尉「乃」當之罰金;竟、居然
弟子「入」則孝;在家
「入」則無法家拂士;在國內
無「入」而不自得;所處的境界
「上」市;到
「上」行出中渭橋;皇上
七歲「上」;約略估計之詞
樓「上」晴天碧四垂;高處
勸君莫「上」最高梯;登上
自上而「下」;下面
哀字「下」得好;用
今既「下」廷尉;交付
「下」車引之;走下
「下」揚州;順流而下
便「下」襄陽向洛陽;順流而去
運動「下」漁舟;劃下
花之富貴者「也」;表示判斷的語氣
必「也」射乎;表示停頓的語氣，啊
蓮，花之君子者「也」;表判斷或決定的語氣
可恃而不可恃「也」、自立者「也」;表判斷語氣、
昏與庸「也」、無以異「也」 不知其;表決定語氣
其操心「也」危、必「也」射乎、其爭「也」君子、其妻妾不羞「也」而不相泣者，幾希矣;表停頓的語氣，同「阿」
不逮人「也」、倍人「也」;表陳述語氣
不知幾千里「也」;表感嘆語氣
何謂「也」;表疑問的語氣
最喜小兒「亡賴」;形容無所事事，頑皮活潑的樣子
「亡賴」之徒;指無業遊民、品行不好的人
「中」通外直;中心，中間
得失無動於「中」;內心
動「中」事禮;切合
無惑乎王「之」不智、通國「之」善弈者也 君子「之」學貴慎始;不等於「的」的介詞
吾資「之」聰、人「之」為學、西蜀「之」去南海、人「之」立志、僧「之」富者、吾資「之」昏;不等於的
屬「之」廷尉，當「之」罰金，上使立誅「之」;他，指人犯
使「之」居於王所;他，指薛居州
為「之」，學「之」，旦旦而學「之」;它
唯陛下察「之」;它，指這件事
而更重「之」;它，指罪
每履「之」、遂安「之」、取土平「之」;它，指窪地
「之」夷狄;往
子欲子「之」王之善與、引而置之莊、嶽「之」間、天下易生「之」物、今夫弈「之」為數;的
養晦堂「知」西偏一室;的
惟弈秋「之」為聽;表示賓語提前
一室「之」不治;表示賓語提前的助詞，無義
久「之」;表順適語氣
蓮「之」愛;表賓語提前
又久而後安「之」;指平地
日暴「之」，十日寒「之」;指易生之物
一人雖聽「之」;指弈秋
蓋簡桃核修狹者為「之」;指核舟
雖與「之」俱學、弗若「之」矣;指專心致志的人
閉「之」;指窗
使齊人傅「之」、眾楚人咻「之」、引而置「之」莊、嶽之間;指楚大夫的兒子
石青糝「之」;指對聯刻紋
吾退而寒「之」者王矣;指齊宣王
篷覆「之」;指艙
思援弓繳而射「之」;指鴻鵠
久「之」，以為行已過;無意義
欲其子「之」齊語;學習
「尤」愛他畫的少女和小孩;更
「尤」其;更加
不「尤」人;怨恨
我「尤」愛他畫的少女和小孩;特別
剛毅「木」訥;性情質樸
神「木」;樹木
「止」有一班文官;只
遂「止」住三軍;制止
「止」，吾「止」也;停止
「止」知其一，唯恐不「止」其一時孔明身邊並無大將，「止」有一班文官;僅
嘆為觀「止」;盡頭、止境
北風勁「且」哀;又
「且」焉置土石;而且
「且」惜寸陰;尚且
年「且」九十;將近
今天姑「且」做一次;暫且
又況賢聖不若彼此「平」;呢
迄「平」成;於
生，於我「乎」館;表示順適的語氣，無義
天下事有難易「平」;嗎，表疑問語氣
巧言「令」色;美善
「令」他馬;假使
「以」建民國;用
「以」養天下之人、「以」樂其志;用來
不「以」人廢言;因
不幸相繼「以」死;而
「以」國家為己任;把
生，事之「以」禮;依
差「以」千里;通「之」，無義
許「以」自由;通「於」，給
何「以」天下國家為;憑
「以」君之力、「以」殘年餘力;憑、用
「出」則弟;在外
「出」則無敵國外患者;在國外
「出」淤泥而不染;長出
口「占」一絕;只以口誦詩句而不以文字寫下
「占」ト;從預兆推斷吉凶
「占」領;據有
西蜀之「去」南海;距離
曾不吝惜「去」留;離開
宋亡，惟「可」死;只
遂「可」其奏;准許
而窪者若「平」;平地
足履「平」地;平坦的
但不能「平」的;甘心
不能「平」;甘心、服氣
吾與汝畢力「平」險，何苦而不「平」;剷平
譬如「平」地;填平
公路「平」坦地展開;寬平的
天下之「平」;標準
「生」，於我乎館;(朋友)活著的時候
我此「生」;一世，一輩子
手法雖「生」;不熟練
「生」之慾望;生命
「生」命;性命
「生」，事之以禮;指父母在世時
春風吹又「生」;滋長
「白」糖;一種顏色
坦「白」;直率
他「白」瞪著眼;徒然
「白白」糟蹋;徒然地，空空地
明「白」;清楚
寫「白」字;錯誤的
莫「名」其妙、莫「名」的興奮;形容、述說
「名」為一件事的;稱
「名」聞遐邇;聲譽
「好」逸惡勞;喜歡
醉裡吳音相媚「好」;親密和樂
晏「如」也;......的樣子
嗜冰「如」命;好像
其「如」土石何;奈
吾「如」有盟焉何哉;假如
晏「如」;樣子
「宇」宙;上下四方
梵「宇」僧樓;寺廟
「安」能辨我是雌雄;如何
鳥兒將窠巢「安」在繁花綠葉之中;放置
既久而遂「安」之，又久後而「安」之;習慣
「次」生林;再
第一「次」;回，數量詞
僅「次」於蒼蠅;差一等
「行」拂亂其所為;又
後「行」;下船
上「行」至中渭橋;出巡
「行」拂亂其所為、復「行」下船;再、又
一「行」白鷺上青天;列
步「行」至鵲華橋邊;走
然後「行」罰;施行
鐘表「行」;商店
即「行」枯萎;將要
「行」潦川流;道路
正在修「行」;實行
「行」之苟有恆;實行、做
「但」卻新鮮而刺激;不過
「但」覺他們的樣子很難看;只
「但」使願無違;只要
見乘與車騎「即」走耳;立刻
「即」乎其故;接觸
遂「步」至承天寺、相與「步」於中庭;行、走
不得不專心地停下腳「步」;步伐
相與「步」於中庭;走
「甫」經下船即遭沉沒者;剛剛
虞山王毅叔遠「甫」;稱人的字
修身「見」於世;表現，通「現」
遇「見」一株美麗的樹;看到
惟恐「見」得;被
成「見」;意見
出入之「迂」也;迂迴，繞路而行
暗笑他的「迂」;迂腐，指不懂得實際社會情況
「迄」平成;到
「迄」未掛懷;始終
所學何「事」;事情
汝以「事」宋者事我;侍奉
縱「使」;即使
「使」喚;命令
「使」騎捕;派遣
懼「其」不已、感「其」誠;他
力贊「其」決;他，指向元世祖上奏章的臣子
自恃「其」昏與庸而不學、不自限「其」昏與庸;自己的
而不知「其」昏與庸也、「其」昏與庸無以異也;那
「其」一貧、「其」一富;其中
用「其」判將;指宋朝
「其」如土石何;將
惟「其」義盡;無義
「味」其言;思量
香「味」;氣味
勝「固」欣然;本來
汝心之「固」，「固」不可徹;固執
「固」不敗傷我乎;豈，難道
「固」不敗傷乎;豈、難道
「固」執;堅持己見，不改變
莫「尚」平勤;同「上」，重要
「尚」義氣;注重
品德高「尚」;清高
蔚為風「尚」;習尚
土人「尚」不斷來此;還
順境亦「居」十三四;占
「居」則致其敬;平常在家的時候
無怪乎「居」四民之末;處
他日「居」官;當
輕「忽」學業;不重視
條「忽」即逝;很快地
「忽」東「忽」西;突然
「或」許;不一定
無「或」乎王之不智也;同「惑」，疑惑
「或」千「或」百;有的
無從「抵」禦;抗拒
枯葉被踩碎的微末聲響直「抵」內心;到達
家書「抵」萬金;值得
大「抵」天下事從苦中得來的樂才算真樂;總括之詞
又高「於」農夫一等;比
又常「於」土牆凹凸處;在
當蚊「於」素帳中;在
至「於」犬馬;到
之「於」人者太多;從
是法不信「於」民;被
得志，澤加「於」民;給
士獨「於」民大不便;對於
「昂」首觀之;抬起
「昂」然挺立;高傲不屈
「昏」天黑地;黑暗
與人交友越容「易」;不難
萬金不「易」、以物「易」物;交易、交換
萬金不「易」;交換
改名「易」姓、移風「易」俗;改變
平「易」近人;和氣、合順的
深耕而「易」耨;治
深耕「易」耨治;指處理得很好
人之為學者有難「易」乎;容易
寒暑「易」節;變換
「果」如鶴唳雲端;真的
行必「果」;堅決不改變
「沿」襲舊習;因襲相傳
桌「沿」;邊
待人接「物」;人
風「物」習俗;人情
人總會去尋求自己喜歡的「事」物;東西
「物」外之趣;物體
「空」悲切;白白地
積水「空」明;透明
簞瓢履「空」;無，沒有
學而不思則「岡」;迷惘、困惑
「岡」不因勢象形;無
可愛「者」甚蕃;的(花)
法「者」，天子所與天下公共也;啊，表示停頓的語氣
「肩」起小鐮刀;扛著
像是有幾千斤重擔子壓在「肩」頭;頸臂相連的地方
小雨紅「芳」綻;花
久久自芬「芳」;花香
「芳」醇;香
林「表」;外
鐘「表」行;計時器
為人師「表」;模範、榜樣
「表」明;顯露出來
永「垂」不朽;留傳後世
「垂」老;將、快要
碧四「垂」;掛下來
「恍」然;忽然覺悟
「恍惚」;神智不清
「故」時有物外之趣;因此、所以
親非「故」、一見如「故」;好友
明知「故」犯;有意的
故者，不失其為「故」;老朋友
「故」人具雞黍、經年守「故」林;老的、舊的
「故」作此態;故意
人問其「故」;原因
「故」鄉;原來的
溫「故」知新;過去的事物
「故」步自封;舊的
「是」法不信於民也;這
主義「是」從;無意義
廷尉當「是」也;對的
胳膊上「架」著的鷹;支立
搭一瓜「架」;用竹木搭的棚子
在小溪旁「架」起了水車;搭設
何以天下國家「為」;乎、呢
項「為」之強、「為」之怡然稱快、用法皆「為」輕重;因
天下用法皆「為」輕重;因此
「為」之怡然稱快;因為
「為」人者五;有
惟弈秋之「為」聽;表示賓與提前
士「為」四民之末;是
「為」民前鋒;做
「為」宮室;做、刻
譬如「為」山;堆積
好人「為」壞人所累、盡「為」所吞;被
「為」是其智弗若與;通「謂」，說
「為」大家謀幸福;替
今夫弈之「為」數;無意義
堪「為」農夫以沒世、彼稱我「為」主人、「為」民前鋒;當、做
以國家「為」己任;當作
一心以「為」有鴻鵠將至;認為、當作
堂「皇」;大
倉「皇」;匆忙的樣子
罪裡吳音「相」媚好;互相、彼此
余當以誠意「相」待;代詞性助詞，無義
在旁邊做一個小「相」;古時候典禮中輔導行禮的人
天祥「相」宋於在造之時;輔佐
「盼望」;希望
臨風顧「盼」;看
我想牠的「苦」悶，大概僅次於黏在膠紙上的蒼蠅;精神難受
何「苦」而不平、足「苦」躓焉;擔心
一日之「計」在於晨;打算
「計」日而效功;計算
慷慨「負」氣、「負」勢競上;依恃、依仗
命誇蛾氏二子「負」二山;背
辜「負」生命;違背
不堪「負」荷;擔
蓋簡桃核「修」狹者為之;長
進德「修」業;研習
一「厝」朔東、一「厝」雍南;同「措」，放置
林家大「厝」;房屋
莫「徒」務近功;只是
嗟哉斯「徒」輩;類
棲「息」著五色的魚群;休息
年「息」;利錢
食「息」於天地之間;呼吸
奄奄一「息」;呼吸之氣
這春來一天有一天的消「息」;音信
生生不「息」;停止
不「息」不汗;喘氣
愚公長「息」;嘆息
「格」格價飛;形容鳥飛起拍擊翅膀的聲音
「格」外光彩;特別
踴躍「疾」驅;快速地
恆存乎疢「疾」;病
草枯鷹眼「疾」;銳利
可以調「素」琴，閱金經;不加雕飾的
又留蚊於「素」帳中;白色的
只因「素」稔讀書趣;向來、平日
「翁」姑;丈夫或太太的父親
家祭無忘告乃「翁」;父親
白髮誰家「翁」媼;老公公
右手「執」蒲葵扇;拿著
「執」著;堅決地
固「執」;堅持
「執」行;照著規定做事
「敦」為南北;何、什麼
人非聖賢，「 」能無過;誰
素「帳」;蚊帳
算「帳」;帳目
宋亡，「惟」可死;只
「惟」其義盡;因為
民「惟」邦本;是
沉入思「惟」的安詳;想、考慮
生也有「涯」，而知也無「涯」;窮盡
樓前芳草接天「涯」、無垠無「涯」;邊、際
而貧者至「焉」;了，句末助詞，表示結束語氣
因以為號「焉」;了，助詞
見賢思齊「焉」;之
可遠觀而不可褻玩「焉」;句末助詞，表示結束語氣
且「焉」置土石、汝輩「焉」知;何、那裏
可遠觀兒不可褻玩「焉」;助詞，無義
且「焉」置土石;那裏
而不怠「焉」;於此
則反窒「焉」而不寧;的樣子，順適語氣
可遠觀而不可褻玩「焉」，因以為號「焉」;表示結束語氣，句末助詞
足苦躓「焉」;語末助詞，無義
「陳」述意見;述說
「陳」列;排列
「陳」跡;過去的
「陳」設簡單;擺置
新「陳」代謝;舊
「陳」舊;舊的
山的「頂」巔;最高的地方
霹靂壓「頂」;頭部
帝稱「善」;好
王誰與為「善」;好事
子謂薛居州「善」士也;好的
友「善」柔;精於、長於
通國之「善」弈者;擅長
「堪」為農夫以沒世;可以
泥濘不「堪」;承受、忍受
諂「媚」;曲意奉承
醉裡吳音相「媚」好;取悅
嫵「媚」的康和也望不見蹤跡;姿態可愛的樣子
妖「媚」;嬌艷
「尋」張懷民;探訪
實在奇「絕」;最
做些針黹生活「尋」來的錢;賺
嘆賞不「絕」;斷
從容「就」義;從事於某事
還來「就」菊花;親近
「揀」過與香山上同樣紅的楓葉;拾取
在秦嶺中「揀」過與香山上 同樣紅的楓葉;拾起
「揀」去小枝小葉;挑選
「揭」曉;公開表露出來
「揭」白旗;高舉
「會」益其所不能;同增
「會」不吝情去留;從來
「會」是以為孝平;竟然
「會」不盈寸;還
「然」而;可是
「然」則昏庸聰敏之用;如此
這卻不「然」;如此
「然」非精潔即不受;但是
吹「然」起行;的樣子
非「然」;對的
徒「然」食息於天地之間;樣子
「然」諾;應許
言論自由「猶」個人自由;好像
「猶」未能也;尚、遠
「猶」豫;遲疑不決的樣子
「絕」不自視非凡;一定
佛印「絕」類彌勒;非常
口占一「絕」;絕句
淒「絕」的哀樂;極
天下獨「絕」;獨一無二
「絕」了氣;斷
吾如有「萌」焉何哉;剛剛產生的善心
讓關心「萌」芽;草木發芽
「虛」有其表;徒然
不「虛」此生;虛度
「虛」懷若谷;謙虛
「買」了紙錢;出拿錢來購物
「買」舟而下;雇
膽氣橫「逸」;充沛
「逸」則淫;安樂
閒情「逸」致;自在
向遠天「逸」去;迅㏿地飛去
菊，花之隱「逸」者也;隱遁不出
「間」壁人家;分隔
「間」或;偶爾、有時候
高下相「間」;隔開、錯雜
蓋大蘇泛赤壁「雲」;句末助詞，無義
孟「雲」取義說;
「意氣」揚揚自若;氣概
「意氣」用事;做事任性不顧一切
廷尉「噹」是也;判決（指內容）
「噹」罰金;判決（指行動）
一「盞」寒泉薦秋菊;小杯子
以我的一生為你點「盞」燈;燈的單位
庸「碌」一生;平凡
勞勞「碌碌」;很忙的樣子
焉「置」土石;安放
且焉「置」土石;安放、放置
「置」酒而後招之;設、準備
知新「置」田穫秋稼五百斛，「置」多田產;購買
「置」酒而招之;擺設
「肆」虐;任意而為
鮑魚之「肆」;店舖、場所
「腫」脹不堪;皮肉發炎脹了起來
臃「腫」;肥胖得難看的樣子
村「落」;人聚居的地方
「落」花水面皆文章;掉下的、下墜的
人的感情也「落」了;脫落、低落
廖「落」;稀疏
「落」了;墜落
治生之「道」;方法
千萬路「道」;路
向村莊「道」過晚安;說
「頓」足;用腳跺地
「頓」時想起來;立刻
吃一「頓」飯;表示次數
氣脫委「頓」;疲乏的樣子
貪求無「厭」;通「饜」，滿足
不「厭」其煩;厭惡
人數甚「夥」;多
「夥」計;店中僱用的人
大「夥」兒;親近的朋友
「寥」寥無幾;稀少
「爾」獨哀怨深;你
咨「爾」多士;你們
偶「爾」;語尾助詞，無義
「綻」放;花的開放
破「綻」;裂開
就彷彿「聞」到了;用鼻子嗅
新「聞」;消息
不說香「聞」十里;傳達
處處「聞」名;聽到
念無「與」樂者;一起
多學而識之者「與」;呢、嗎同「歟」
使「與」臺齊;和
上天的賜「與」;給
「蓋」房子;建㐀
「蓋」所柏影也;原來是
「輒」起，繞室以旋;每每，往往
淺嘗「輒」止;就
年「輕」;年紀小
「輕」忽;輕視
逍「遙」法外;不受拘束的樣子
逍「遙」;自由自在，沒有拘束
「遙遙」的天邊;遠
「鄙」夫;見識淺薄
「鄙」其私;看不起
故學會了許多「鄙」事;粗俗
「鄙」事;粗俗卑賤
學會了許多「鄙」事;粗俗卑賤的
蜀之「鄙」;邊遠偏僻的地方
冷「酷」;冷漠無情
殘「酷」;殘暴
「酷」愛;極，非常
「凜」冽的北風;寒冷
正氣「凜」然;敬畏
「履」行;實踐
每「履」之，足「履」平地;踩踏
草「履」;鞋子
無「緣」無故;原因
因「緣」;緣份
機「緣」;機會
「緣」木求魚;攀爬
一言以「蔽」之;包括
遮「蔽」;遮住
不「蔽」風日;遮蔽
則使齊人傅「諸」;「之乎」的合音
加「諸」人類雄心的限制、公「諸」於國民之前;「之於」的合音
使齊人傅「諸」;之乎
則使齊人傳「諸」;之乎的合音
公「諸」國民之前;之於
勸「諸」君立志;很多
「諸」多不便;眾多
看牠高「踞」枝頭;蹲
「踞」在高高的樹枝上;蹲、坐，此處有盤據之意
走一「遭」;事情的次數
點綴這周「遭」的沉默;周圍
慘「遭」淘汰;遇、受
帶月荷「鋤」歸;用來去草翻土的農具
大兒「鋤」豆溪豆;除掉雜草
並「駕」齊驅;車駕
「駕」馭他人;控制、指揮
恭候大「駕」;對別人的敬稱
「獨」取羊百餘只;
「獨」願捨家入山、「獨」處之泰然;卻
「獨」孤臣孽子、予「獨」愛蓮 之出淤泥而不染;特別
「獨」如宋王何;單
不「獨」是對於一個人如此;僅、只
「衡」於慮;通「衡」，阻塞不順
左手倚一「衡」木;橫的
「褪」衣;脫掉衣服
花的顏色也「褪」了;顏色漸漸消失了
呈現出和「諧」的驚人創㐀;安和
間或點綴以輕微的詼「諧」;風趣的言談
吾馬「賴」柔和;幸虧、好在
亡「賴」;游手好閒的人
「賴」著不走;藉故拖延
便悲福「薄」;少
菲「薄」;輕視
你身子很單「薄」;瘦弱
盞寒泉「薦」秋菊;供奉祭祀
寂「寥」;寂靜
推「薦」;推介
新陳代「謝」;消逝
凋「謝」;落
感「謝」;對別人的恩惠表達敬意
「趨」炎附勢;依附趨勢
「趨」之如歸;奔赴、前往
乘時「趨」利;追求
「輿」論;大眾的
「輿」論政治;公眾的
乘「輿」馬驚;古代指轎子
卻上輕「輿」趁晚涼;轎子
如琴「鍵」的起落;琴的鍵盤
關「鍵」;關閉門戶用的橫木或木閂，後用以比喻事物扼要的部分
竹「簡」;古時用來寫字的竹片
「簡」陋;略而不繁
蓋「簡」桃核修狹者為之;選擇
「藉」;假借
杯盤狼「藉」;散亂的樣子
溫和蘊「藉」;寬大有餘
「藉」此學習在風景之中挺立起來;憑、依靠
「藉」此學習在風暴之中挺立起來;憑、依靠
「懲」山北之塞;引以為苦
「懲」罰;處罰
右手「攀」右趾;抓著
他用兩手「攀」著上面;從下往上拉
自「贊」;頌、評論
「贊」曰;稱揚或評論人物的文體
力「贊」其決;贊成，同意
但使「願」無違;心願
「願」給老年以安樂;希望
對未來善加「籌」畫;謀畫
高出一「籌」;籌碼
「躍躍」欲試;心情激動，很想做而不能自制的樣子
驚喜雀「躍」;形容高興的樣子
在進德修業上都有飛「躍」;跳動，指進德修業的突飛猛進
「顧」不如蜀鄙之僧乎;反而
臨風「顧」盼;左右張望
不屑一「顧」;回頭看
三「顧」茅廬;拜訪
「顧」而笑之;看
臨風「顧」盼，牠不回「顧」;看、左右張望
臨風「顧」盼、左「顧」右盼、四「顧」無人;看、張望
「顧」水田;看守
入門不「顧」;理睬
不「顧」一切;想著、眷念
奮不「顧」身、周郎「顧」曲;關注
不「驚」田水冷霜霜;害怕
「驚」羨;驚喜
呀然「驚」恐;驚嚇、吃驚`
            };

            // --- 事件監聽 ---
            fileUpload.addEventListener('change', handleFileUpload);
            loadSelectedExampleBtn.addEventListener('click', () => {
                const selectedKey = exampleSelector.value;
                if (selectedKey && EXAMPLES[selectedKey]) {
                    loadData(EXAMPLES[selectedKey]);
                } else {
                    showError("請從下拉選單中選擇一個範例。");
                }
            });

            prevBtn.addEventListener('click', showPrevCard);
            nextBtn.addEventListener('click', () => showNextCard('unjudged'));
            correctBtn.addEventListener('click', () => showNextCard('correct'));
            incorrectBtn.addEventListener('click', () => showNextCard('incorrect'));
            mainScreen.addEventListener('click', (e) => { if (e.target === mainScreen) { showNextCard('unjudged'); } });
            menuBtn.addEventListener('click', toggleMenu);
            closeMenuBtn.addEventListener('click', toggleMenu);
            menuOverlay.addEventListener('click', toggleMenu);
            showAllBtn.addEventListener('click', showAllCardsView);
            openNewBtn.addEventListener('click', () => { backToUploadScreen(); toggleMenu(); });
            downloadBtn.addEventListener('click', () => { downloadModal.classList.remove('hidden'); toggleMenu(); });
            toggleLayoutBtn.addEventListener('click', toggleCardLayout);
            toggleAutoRevealBtn.addEventListener('click', toggleAutoReveal);
            closeModalBtn.addEventListener('click', () => allCardsModal.classList.add('hidden'));
            closeDownloadModalBtn.addEventListener('click', () => downloadModal.classList.add('hidden'));
            document.querySelectorAll('.download-format-btn').forEach(btn => {
                btn.addEventListener('click', (e) => downloadData(e.target.dataset.format));
            });
            // 新增：教學與字體大小事件監聽
            howToUseBtn.addEventListener('click', () => { howToUseModal.classList.remove('hidden'); toggleMenu(); });
            closeHowToUseModalBtn.addEventListener('click', () => { howToUseModal.classList.add('hidden'); });
            fontSizeIncrease.addEventListener('click', () => {
                if (cardFontSize < MAX_FONT_SIZE) {
                    cardFontSize = Math.min(MAX_FONT_SIZE, cardFontSize + FONT_SIZE_STEP);
                    updateCardFontSize();
                }
            });
            fontSizeDecrease.addEventListener('click', () => {
                if (cardFontSize > MIN_FONT_SIZE) {
                    cardFontSize = Math.max(MIN_FONT_SIZE, cardFontSize - FONT_SIZE_STEP);
                    updateCardFontSize();
                }
            });

            // --- 核心功能 ---
            function loadData(content) {
                try {
                    parseFileContent(content);
                    startGame();
                } catch (error) {
                    showError(error.message);
                    resetApp();
                }
            }
            
            function handleFileUpload(event) {
                const file = event.target.files[0];
                if (!file || !file.name.endsWith('.txt')) { showError("請選擇一個 .txt 檔案。"); return; }
                const reader = new FileReader();
                reader.onload = (e) => { loadData(e.target.result); };
                reader.onerror = () => { showError("讀取檔案時發生錯誤。"); resetApp(); };
                reader.readAsText(file);
            }
            
            function parseFileContent(content) {
                const lines = content.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                if (lines.length === 0) throw new Error("檔案為空或格式不正確。");
                fieldsPerCard = lines[0].split(';').length;
                if (fieldsPerCard < 1) throw new Error("檔案格式錯誤，每行至少需有一個欄位。");
                fullDeck = lines.map((line, index) => {
                    const fields = line.split(';');
                    if (fields.length !== fieldsPerCard) throw new Error(`檔案格式錯誤：第 ${index + 1} 行預計有 ${fieldsPerCard} 個欄位，但實際有 ${fields.length} 個。`);
                    return fields.map(field => field.trim().replace(/\/\//g, '<br>'));
                });
            }

            function startGame() {
                cardStatus.clear();
                fullDeck.forEach(cardData => { cardStatus.set(JSON.stringify(cardData), 'unseen'); });
                learningDeck = [...fullDeck];
                shuffleDeck(learningDeck);
                uploadScreen.classList.add('hidden');
                mainScreen.classList.remove('hidden');
                mainScreen.classList.add('flex');
                history = [];
                historyIndex = -1;
                resetFontSize();
                showNextCard('new_game');
            }
            
            function restartGame() {
                fullDeck.forEach(cardData => { cardStatus.set(JSON.stringify(cardData), 'unseen'); });
                learningDeck = [...fullDeck];
                shuffleDeck(learningDeck);
                history = [];
                historyIndex = -1;
                [prevBtn, nextBtn, correctBtn, incorrectBtn].forEach(btn => btn.disabled = false);
                resetFontSize();
                showNextCard('new_game');
            }

            function showNextCard(action) {
                if (historyIndex >= 0 && historyIndex < history.length) {
                    const currentCardData = history[historyIndex];
                    const cardKey = JSON.stringify(currentCardData);
                    if (action === 'correct') {
                        cardStatus.set(cardKey, 'correct');
                        learningDeck = learningDeck.filter(cardData => JSON.stringify(cardData) !== cardKey);
                    } else if (action === 'incorrect') { cardStatus.set(cardKey, 'incorrect'); }
                }

                let nextCardData;
                if (historyIndex < history.length - 1) {
                    historyIndex++;
                    nextCardData = history[historyIndex];
                } else {
                    if (learningDeck.length === 0) { displayEndOfDeck(); return; }
                    const randomIndex = Math.floor(Math.random() * learningDeck.length);
                    nextCardData = learningDeck[randomIndex];
                    history.push(nextCardData);
                    if (history.length > MAX_HISTORY) { history.shift(); }
                    historyIndex = history.length - 1;
                }
                
                const nextCardKey = JSON.stringify(nextCardData);
                if (cardStatus.get(nextCardKey) === 'unseen') { cardStatus.set(nextCardKey, 'unjudged'); }
                displayCardGroup(nextCardData);
                updateUI();
            }

            function showPrevCard() {
                if (historyIndex > 0) {
                    historyIndex--;
                    displayCardGroup(history[historyIndex]);
                } else {
                    historyAlert.classList.remove('hidden');
                    setTimeout(() => historyAlert.classList.add('hidden'), 1500);
                }
                updateUI();
            }

            function displayCardGroup(cardData) {
                cardContainer.innerHTML = '';
                const layouts = {
                    horizontal: { 1: 'grid-cols-1 grid-rows-1', 2: 'grid-cols-2 grid-rows-1', 3: 'grid-cols-3 grid-rows-1', 4: 'grid-cols-4 grid-rows-1', 5: 'grid-cols-5 grid-rows-1', 6: 'grid-cols-3 grid-rows-2' },
                    vertical: { 1: 'grid-cols-1 grid-rows-1', 2: 'grid-cols-1 grid-rows-2', 3: 'grid-cols-1 grid-rows-3', 4: 'grid-cols-1 grid-rows-4', 5: 'grid-cols-2 grid-rows-3', 6: 'grid-cols-2 grid-rows-3' }
                };
                cardContainer.className = `grid gap-2 w-full h-full ${layouts[cardLayout][fieldsPerCard] || 'grid-cols-2 grid-rows-2'}`;

                cardData.forEach(content => {
                    const card = document.createElement('div');
                    card.className = 'card bg-white dark:bg-gray-700 rounded-xl shadow-md flex items-center justify-center p-4 text-center cursor-pointer transition-transform transform hover:scale-105';
                    card.innerHTML = `<span class="placeholder text-5xl text-gray-400 dark:text-gray-500">?</span><div class="content">${content}</div>`;
                    card.addEventListener('click', (e) => { e.stopPropagation(); card.classList.toggle('revealed'); });
                    cardContainer.appendChild(card);
                });

                updateCardFontSize(); // 套用當前字體大小

                if (autoRevealFirstCard) {
                    const firstCard = cardContainer.querySelector('.card');
                    if (firstCard) firstCard.classList.add('revealed');
                }
            }

            function displayEndOfDeck() {
                cardContainer.innerHTML = `<div class="col-span-full row-span-full flex flex-col items-center justify-center text-center p-8 bg-white dark:bg-gray-700 rounded-xl"><h2 class="text-3xl font-bold mb-4">🎉 恭喜！</h2><p class="text-xl">您已學會所有卡片！</p><button id="restart-btn" class="mt-8 px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 transition-colors">重新開始</button></div>`;
                document.getElementById('restart-btn').addEventListener('click', restartGame);
                [prevBtn, nextBtn, correctBtn, incorrectBtn].forEach(btn => btn.disabled = true);
                deckInfo.textContent = '完成!';
            }

            function updateUI() {
                prevBtn.disabled = historyIndex <= 0;
                nextBtn.disabled = learningDeck.length === 0 && historyIndex === history.length - 1;
                deckInfo.textContent = `待學習: ${learningDeck.length} 組`;
            }
            
            // --- 選單和 Modal 功能 ---
            function toggleMenu() {
                menuPanel.classList.toggle('open');
                menuPanel.classList.toggle('closed');
                menuOverlay.classList.toggle('hidden');
            }
            
            function toggleCardLayout() {
                cardLayout = (cardLayout === 'horizontal') ? 'vertical' : 'horizontal';
                if (history.length > 0) displayCardGroup(history[historyIndex]);
                toggleMenu();
            }

            function toggleAutoReveal() {
                autoRevealFirstCard = !autoRevealFirstCard;
                const statusSpan = toggleAutoRevealBtn.querySelector('span');
                if (autoRevealFirstCard) {
                    statusSpan.textContent = '開';
                    statusSpan.className = 'font-bold text-green-500';
                } else {
                    statusSpan.textContent = '關';
                    statusSpan.className = 'font-bold text-red-500';
                }
            }
            
            function backToUploadScreen() {
                resetApp();
                mainScreen.classList.add('hidden');
                mainScreen.classList.remove('flex');
                uploadScreen.classList.remove('hidden');
                errorMessage.textContent = '';
            }

            function showAllCardsView() {
                allCardsModal.classList.remove('hidden');
                toggleMenu();
                const statusIcons = { correct: '✅', incorrect: '❌', unjudged: '⬜', unseen: '⬜' };
                let tableHTML = '<thead><tr class="border-b border-gray-200 dark:border-gray-600"><th class="p-2">狀態</th>';
                for (let i = 1; i <= fieldsPerCard; i++) { tableHTML += `<th class="p-2">卡片 ${i}</th>`; }
                tableHTML += '</tr></thead><tbody>';
                fullDeck.forEach(cardData => {
                    const key = JSON.stringify(cardData);
                    const status = cardStatus.get(key) || 'unseen';
                    tableHTML += `<tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-900"><td class="p-2 text-center">${statusIcons[status]}</td>`;
                    cardData.forEach(field => { tableHTML += `<td class="p-2">${field.replace(/<br>/g, ' ')}</td>`; });
                    tableHTML += '</tr>';
                });
                tableHTML += '</tbody>';
                allCardsTable.innerHTML = tableHTML;
            }
            
            // --- 下載功能 ---
            function getCleanData() {
                const statusIcons = { correct: '✅', incorrect: '❌', unjudged: '⬜', unseen: '⬜' };
                const headers = ['狀態', ...Array.from({ length: fieldsPerCard }, (_, i) => `卡片 ${i + 1}`)];
                const rows = fullDeck.map(cardData => {
                    const key = JSON.stringify(cardData);
                    const status = cardStatus.get(key) || 'unseen';
                    return [statusIcons[status], ...cardData.map(field => field.replace(/<br>/g, ' ').replace(/\s+/g, ' ').trim())];
                });
                return { headers, rows };
            }

            function downloadData(format) {
                const { headers, rows } = getCleanData();
                const filename = `card_data_${new Date().toISOString().slice(0,10)}`;
                
                if (format === 'csv') {
                    let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
                    csvContent += headers.join(',') + '\r\n';
                    rows.forEach(row => {
                        const rowData = row.map(field => `"${String(field).replace(/"/g, '""')}"`);
                        csvContent += rowData.join(',') + '\r\n';
                    });
                    triggerDownload(encodeURI(csvContent), `${filename}.csv`);
                } else if (format === 'txt') {
                    let txtContent = headers.join('\t') + '\r\n';
                    rows.forEach(row => { txtContent += row.join('\t') + '\r\n'; });
                    const blob = new Blob([txtContent], { type: 'text/plain;charset=utf-8,' });
                    triggerDownload(URL.createObjectURL(blob), `${filename}.txt`);
                }
                downloadModal.classList.add('hidden');
            }

            function triggerDownload(uri, filename) {
                const link = document.createElement("a");
                link.href = uri;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            // --- 輔助功能 ---
            // 新增：更新卡片字體大小的函式
            function updateCardFontSize() {
                const cards = document.querySelectorAll('#card-container .card');
                const newSize = `${cardFontSize.toFixed(1)}rem`;
                cards.forEach(card => {
                    card.style.fontSize = newSize;
                });
                fontSizeValue.textContent = newSize;
            }
            
            // 新增：重設字體大小的函式
            function resetFontSize() {
                cardFontSize = DEFAULT_FONT_SIZE;
                fontSizeValue.textContent = '預設';
                updateCardFontSize();
            }

            function shuffleDeck(deckToShuffle) {
                for (let i = deckToShuffle.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [deckToShuffle[i], deckToShuffle[j]] = [deckToShuffle[j], deckToShuffle[i]]; }
            }
            function showError(message) { errorMessage.textContent = message; }
            function resetApp() {
                fullDeck = []; learningDeck = []; cardStatus.clear(); history = []; historyIndex = -1; fieldsPerCard = 0; fileUpload.value = '';
            }
        });
    </script>
</body>
</html>
